# config.toml â€” All tunable parameters for the Fitness Form Capture Kiosk
# Adjust these values during testing to optimize capture quality and speed.

# ===========================================================================
#  OCR BACKEND SELECTION  (restart required to switch)
# ===========================================================================

[ocr]
# "openrouter" = Cloud API (GPT-4o, Claude, Gemini via OpenRouter)
# "ollama"     = Local CPU inference (Qwen2.5VL, Llama 3.2 Vision, Moondream)
backend = "ollama"

# ===========================================================================
#  OLLAMA (Local CPU inference)
# ===========================================================================

[ollama]
host = "http://localhost:11434"

# --- Model selection ---
# Option A (Balanced):   "llama3.2-vision:11b"   ~8GB RAM, 5-10s/image
# Option B (OCR expert): "qwen2.5vl:7b"         ~6GB RAM, best for dense text
# Option C (Fast):       "moondream:1.8b"         ~2GB RAM, sub-1s, lower accuracy
extraction_model = "qwen3-vl:2b"
reconciliation_model = "qwen3-vl:2b"

# Context window size (vision models need headroom for image tokens)
num_ctx = 4096

# Timeout per request in seconds (local models on CPU can be slow)
timeout_seconds = 120

# ===========================================================================
#  OPENROUTER (Cloud API)
# ===========================================================================

[api]
openrouter_api_key_env = "OPENROUTER_API_KEY"
openrouter_base_url = "https://openrouter.ai/api/v1"
api_timeout_seconds = 30
http_referer = "https://github.com/fitness-kiosk"
app_title = "Fitness Form Kiosk"

[models]
# OpenRouter model strings â€” swap these to test different providers
cardio_extraction_model = "openai/gpt-4o"
strength_extraction_model = "openai/gpt-4o"
reconciliation_model = "openai/gpt-4o"

# Alternatives:
# "anthropic/claude-3.5-sonnet"
# "google/gemini-2.0-flash-001"

# ===========================================================================
#  CAMERA
# ===========================================================================

[camera]
camera_index = 1
capture_width = 1920
capture_height = 1080
fps_target = 20

# ===========================================================================
#  STATE MACHINE TUNING
# ===========================================================================

[state_transitions]
# CRITICAL: These are the main knobs to tune during testing
form_detection_frames = 10       # READY â†’ PROCESSING
good_capture_frames = 1         # PROCESSING â†’ capture
issue_retry_frames = 5          # ISSUES â†’ PROCESSING

[timeouts]
issue_timeout_seconds = 3.0     # PROCESSING â†’ ISSUES
orphan_timeout_seconds = 120    # AWAITING â†’ save orphan
success_display_seconds = 3     # DONE â†’ READY

# ===========================================================================
#  OPENCV THRESHOLDS
# ===========================================================================

[opencv_thresholds]
blur_threshold = 30             # Laplacian variance minimum
contrast_threshold = 30         # Grayscale std dev minimum
glare_threshold = 0.05          # Max fraction of blown-out pixels
mean_intensity_min = 50         # Minimum brightness

[form_detection]
area_ratio_min = 0.25
area_ratio_max = 0.90
aspect_ratio_min = 1.1
aspect_ratio_max = 1.8
canny_low = 50
canny_high = 150
gaussian_kernel = 5
contour_approx_epsilon = 0.05

[page_detection]
header_crop_fraction = 0.15
dark_pixel_threshold_cardio = 0.3
dark_pixel_threshold_strength = 0.1

[buffer]
frame_buffer_size = 5

# ===========================================================================
#  PATHS
# ===========================================================================

[paths]
capture_dir = "./captures"
orphan_dir = "./orphans"
result_dir = "./results"
temp_dir = "./temp"
example_data_file = "./few_shot_examples.json"

# ===========================================================================
#  LOGGING
# ===========================================================================

[logging]
log_level = "INFO"
log_file = "kiosk.log"
log_to_console = true

# ===========================================================================
#  UI
# ===========================================================================

[ui]
title = "ðŸ’ª Fitness Form Capture Kiosk"
show_camera_feed = true
show_debug_overlay = true
